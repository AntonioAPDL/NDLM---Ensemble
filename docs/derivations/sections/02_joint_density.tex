\section{Full Joint Density and Posterior Factorization}

\subsection{Model A Joint}
Define $\Theta_A=(\sigma_0^2,\lambda,\bm W^\theta,\bm W^\psi,w^\zeta)$.
The complete joint for historical target-only data is
\begin{align}
p(\bm y_{1:T}^0,\bm\alpha_{0:T},\Theta_A)
&= p(\bm\alpha_0)\,p(\Theta_A)
\prod_{t=1}^T p(\bm\alpha_t\given\bm\alpha_{t-1},\Theta_A)
\prod_{t=1}^T p(y_t^0\given\bm\alpha_t,\sigma_0^2).\label{eq:joint_A}
\end{align}

\subsection{Model B Joint}
Define $\Theta_B=\Theta_A\cup\{\sigma_1^2,\dots,\sigma_J^2,\bm W^{\delta^1},\dots,\bm W^{\delta^J}\}$.
Then
\begin{align}
&p(\bm y_{1:T}^0,\bm z_{1:T}^{1:J},\bm\alpha_{0:T},\bm\delta_{0:T}^{1:J},\Theta_B) \\
&= p(\bm\alpha_0)\prod_{j=1}^J p(\bm\delta_0^j)\,p(\Theta_B)
\prod_{t=1}^T p(\bm\alpha_t\given\bm\alpha_{t-1},\Theta_B)
\prod_{t=1}^T p(y_t^0\given\bm\alpha_t,\sigma_0^2)
\prod_{j=1}^J\prod_{t=1}^T p(\bm\delta_t^j\given\bm\delta_{t-1}^j,\bm W_t^{\delta^j}) \\
&\hspace{3em}\times
\prod_{j=1}^J\prod_{t=1}^T p(z_t^j\given\bm\alpha_t,\bm\delta_t^j,\sigma_j^2).\label{eq:joint_B}
\end{align}

\subsection{Model C Joint}
Let $\Theta_C=(\sigma_1^2,\dots,\sigma_{J_f}^2,\bm W^\beta,\text{forecast hyperparameters})$.
For forecast observations $\mathcal{Y}_{T+1:T+K_{\max}}$ with active-set profile
$\mathcal A_k=\{j:k\le K_j\}$,
\begin{align}
p(\mathcal{Y}_{T+1:T+K_{\max}},\bm\beta_{T:T+K_{\max}},\Theta_C)
&= p(\bm\beta_T)\,p(\Theta_C)
\prod_{k=1}^{K_{\max}} p(\bm\beta_{T+k}\given\bm\beta_{T+k-1},\Theta_C)
\prod_{k=1}^{K_{\max}}\prod_{n=1}^{n_k} p(y_{T+k,n}\given\bm\beta_{T+k},\Theta_C).
\label{eq:joint_C}
\end{align}

\subsection{Posterior Kernel}
The posterior for any model block $\mathcal{M}\in\{A,B,C\}$ is
\begin{align}
p(\text{states},\Theta\given\text{data})\propto
p(\text{data},\text{states},\Theta),
\label{eq:posterior_kernel}
\end{align}
with the explicit factorization given by \eqref{eq:joint_A}--\eqref{eq:joint_C}.
These product forms are the basis for Gibbs blocks and CAVI factors.

\subsection{Computable complete log-joint forms}
For implementation, it is convenient to evaluate each model with explicit residual and innovation sums.
Define
\begin{align}
\bm e_t^{A}&:=\bm\alpha_t-\tilde{\bm G}_t\bm\alpha_{t-1},
& r_t^{0}&:=y_t^0-\tilde{\bm F}_t^\T\bm\alpha_t, \nonumber\\
\bm e_t^{\delta,j}&:=\bm\delta_t^j-\bm G_t\bm\delta_{t-1}^j,
& r_t^{j}&:=z_t^j-\tilde{\bm F}_t^\T\bm\alpha_t-\bm F_t^\T\bm\delta_t^j,\nonumber\\
\bm e_t^{\beta}&:=\bm\beta_t-\bm M_t\bm\beta_{t-1},
& r_{t,n}^{C}&:=y_{t,n}-\bm h_{t,n}^\T\bm\beta_t.
\label{eq:joint_residuals}
\end{align}
Then, up to additive constants independent of unknowns:
\begin{align}
\log p_A
=\;&
\log p(\bm\alpha_0)+\log p(\Theta_A)
-\frac12\sum_{t=1}^{T}\!\left[
\log|\tilde{\bm W}_t|+(\bm e_t^A)^\T \tilde{\bm W}_t^{-1}\bm e_t^A
\right] \nonumber\\
&-\frac12\sum_{t=1}^{T}\!\left[
\log \sigma_0^2+\frac{(r_t^0)^2}{\sigma_0^2}
\right],
\label{eq:log_joint_A}
\end{align}
\begin{align}
\log p_B
=\;&
\log p_A
+\sum_{j=1}^{J}\log p(\bm\delta_0^j)
-\frac12\sum_{j=1}^{J}\sum_{t=1}^{T}\!\left[
\log|\bm W_t^{\delta^j}|+(\bm e_t^{\delta,j})^\T(\bm W_t^{\delta^j})^{-1}\bm e_t^{\delta,j}
\right] \nonumber\\
&-\frac12\sum_{j=1}^{J}\sum_{t=1}^{T}\!\left[
\log \sigma_j^2+\frac{(r_t^j)^2}{\sigma_j^2}
\right],
\label{eq:log_joint_B}
\end{align}
\begin{align}
\log p_C
=\;&
\log p(\bm\beta_T)+\log p(\Theta_C)
-\frac12\sum_{k=1}^{K_{\max}}\!\left[
\log|\bm W_k^\beta|+(\bm e_k^\beta)^\T(\bm W_k^\beta)^{-1}\bm e_k^\beta
\right] \nonumber\\
&-\frac12\sum_{k=1}^{K_{\max}}\sum_{n=1}^{n_k}\!\left[
\log \sigma^2_{\mathrm{src}(k,n)}+\frac{(r_{k,n}^{C})^2}{\sigma^2_{\mathrm{src}(k,n)}}
\right],
\label{eq:log_joint_C}
\end{align}
where $\mathrm{src}(k,n)$ maps each scalar observation to its source-variance index.
In ragged-horizon Model C, $n_k$ changes with $\mathcal A_k$, and
$(\bm W_k^\beta,\bm e_k^\beta,r_{k,n}^C)$ are interpreted on the lead-specific
active state (or its exact fixed-dimension embedding).
Equations \eqref{eq:log_joint_A}--\eqref{eq:log_joint_C} are the direct objectives used to
compute sufficient statistics for both Gibbs updates and CAVI blocks.
