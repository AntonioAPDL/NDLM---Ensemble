\section{Mean-Field Variational Bayes (CAVI)}

\subsection{Factorization}
Use
\begin{align}
q(\text{states},\sigma^2,W,\lambda)
= q(\text{states})\prod_{j=0}^J q(\sigma_j^2)\prod_b q(\bm W_b)q(\lambda).
\label{eq:vb_factorization}
\end{align}

\subsection{State Factor}
Given current expected precisions,
\begin{align}
q(\text{states})\propto
\exp\Big(\E_{-\text{states}}[\log p(\text{data},\text{states},\sigma^2,W,\lambda)]\Big),
\end{align}
which remains Gaussian and is computed by a Kalman smoother on a pseudo-model with
$\E_q[1/\sigma_j^2]$ and $\E_q[\bm W_b^{-1}]$ inserted.

\subsection{Variance Factors}
For each $j$,
\begin{align}
q(\sigma_j^2) &= \IG(\tilde a_{\sigma j},\tilde b_{\sigma j}), \\
\tilde a_{\sigma j} &= a_{\sigma j}+\frac{N_j}{2}, \\
\tilde b_{\sigma j} &= b_{\sigma j}+\frac{1}{2}\E_q[\mathrm{SSE}_j].
\label{eq:vb_sigma}
\end{align}

\subsection{Evolution Covariance Factors}
For each block $b$,
\begin{align}
q(\bm W_b) &= \IW(\tilde\nu_b,\tilde{\bm S}_b), \\
\tilde\nu_b &= \nu_b + T_b, \\
\tilde{\bm S}_b &= \bm S_b + \sum_{t=1}^{T_b} \E_q[\bm e_t\bm e_t^\T].
\label{eq:vb_W}
\end{align}

\subsection{Transfer Coefficient Factor}
With Gaussian prior and constant $w^\zeta$,
\begin{align}
q(\lambda)=\N(\tilde m_\lambda,\tilde C_\lambda),
\end{align}
where
\begin{align}
\tilde C_\lambda^{-1}
&= C_{\lambda0}^{-1}+\frac{1}{w^\zeta}\sum_{t=1}^T\E_q[\zeta_{t-1}^2], \\
\tilde m_\lambda
&= \tilde C_\lambda\left(C_{\lambda0}^{-1}m_{\lambda0}+\frac{1}{w^\zeta}\sum_{t=1}^T\E_q[\zeta_{t-1}(\zeta_t-\bm x_t^\T\bm\psi_t)]\right).
\label{eq:vb_lambda}
\end{align}

\subsection{Expectations Required Each Iteration}
\begin{itemize}
\item $\E_q[1/\sigma_j^2]$, $\E_q[\log\sigma_j^2]$,
\item $\E_q[\bm W_b^{-1}]$, $\E_q[\log|\bm W_b|]$,
\item $\E_q[\bm x_t]$, $\E_q[\bm x_t\bm x_t^\T]$, $\E_q[\bm x_t\bm x_{t-1}^\T]$,
\item $\E_q[\mathrm{SSE}_j]$ and $\E_q[\bm e_t\bm e_t^\T]$.
\end{itemize}
